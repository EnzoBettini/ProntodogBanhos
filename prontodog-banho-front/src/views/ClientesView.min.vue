<template><div class="min-h-screen bg-gradient-to-br from-emerald-50 via-white to-green-100"><div class="relative overflow-hidden bg-gradient-to-r from-emerald-600 via-green-600 to-emerald-700 text-white"><div class="absolute inset-0 opacity-10 bg-pattern"></div><div class="relative px-6 py-8 z-20"><div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6"><div class="flex items-center gap-4 animate-fade-in-up"><div class="relative"><div class="w-16 h-16 bg-white bg-opacity-20 backdrop-blur-sm rounded-2xl flex items-center justify-center transform hover:scale-110 transition-all duration-300 shadow-lg"><FontAwesomeIcon icon="users" class="text-2xl text-white animate-bounce-gentle" /></div><div v-if="!loading && clientes.length >0" class="absolute -top-1 -right-1 w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center animate-pulse"><span class="text-xs font-bold text-yellow-800">{{ clientes.length}}</span></div></div><div class="space-y-1"><h1 class="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-emerald-100">Lista de Clientes </h1><p class="text-white text-lg flex items-center gap-2 font-medium opacity-90"><FontAwesomeIcon icon="star" class="text-yellow-400 animate-twinkle mr-1" />Gerencie todos os clientes do ProntoDog Banhos </p></div></div><div class="flex items-center gap-3"><button @click="carregarClientes" :disabled="loading" class="group flex items-center gap-2 px-4 py-2 bg-white bg-opacity-20 backdrop-blur-sm text-white rounded-xl hover:bg-opacity-30 transition-all duration-300 border border-white border-opacity-20 hover:border-opacity-40 transform hover:-translate-y-1 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed" ><FontAwesomeIcon :icon="loading ? 'spinner' : 'refresh'" :class="{ 'animate-spin': loading, 'group-hover:rotate-180': !loading}" class="transition-transform duration-300" /><span class="font-medium">{{ loading ? 'Carregando...' : 'Atualizar'}}</span></button><button @click="$router.push('/clientes/novo')" class="group flex items-center gap-2 px-6 py-2 bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-xl hover:from-yellow-500 hover:to-orange-600 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-xl font-medium shadow-lg" ><FontAwesomeIcon icon="plus" class="group-hover:rotate-90 transition-transform duration-300" /><span>Novo Cliente</span></button></div></div></div><div class="absolute bottom-0 left-0 right-0 z-10"><svg viewBox="0 0 1440 60" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-15"><defs><linearGradient id="waveGradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" /><stop offset="50%" style="stop-color:#1d4ed8;stop-opacity:1" /><stop offset="100%" style="stop-color:#1e40af;stop-opacity:1" /></linearGradient></defs><path d="M0 60h1440V0c-120 40-240 60-360 60S840 40 720 60s-240 0-360-60S120 40 0 60z" fill="url(#waveGradient)"/></svg></div></div><div class="relative -mt-8 px-6 pb-8 z-30"><div v-if="loading && clientes.length===0" class="text-center py-12"><FontAwesomeIcon icon="spinner" class="text-4xl text-primary-500 animate-spin mb-4" /><h3 class="text-lg font-medium text-gray-700 mb-2">Carregando clientes...</h3><p class="text-gray-500">Buscando dados na API</p></div><div v-else-if="error" class="text-center py-12"><FontAwesomeIcon icon="exclamation-triangle" class="text-4xl text-red-500 mb-4" /><h3 class="text-lg font-medium text-red-700 mb-2">Erro ao carregar clientes</h3><p class="text-red-600 mb-4">{{ error}}</p><BaseButton variant="outline" @click="carregarClientes"><FontAwesomeIcon icon="refresh" class="mr-2" />Tentar Novamente </BaseButton></div><div v-else-if="!loading && clientes.length===0" class="text-center py-12"><FontAwesomeIcon icon="users" class="text-4xl text-gray-400 mb-4" /><h3 class="text-lg font-medium text-gray-700 mb-2">Nenhum cliente encontrado</h3><p class="text-gray-500 mb-4">Comece adicionando seu primeiro cliente!</p><BaseButton variant="primary" @click="$router.push('/clientes/novo')"><FontAwesomeIcon icon="plus" class="mr-2" />Adicionar Primeiro Cliente </BaseButton></div><div v-else><BaseCard class="mb-6 shadow-lg border-0 bg-white bg-opacity-90 backdrop-blur-sm animate-slide-up"><div class="p-4"><div class="flex flex-col md:flex-row gap-4 items-center"><div class="flex-1 relative group"><div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><FontAwesomeIcon icon="search" class="h-5 w-5 text-emerald-400" /></div><input v-model="filtroBusca" type="text" placeholder="Buscar por nome, CPF, ID ou código SimplesVet..." class="w-full pl-10 pr-12 py-3 bg-gradient-to-r from-white to-emerald-50 border border-emerald-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-300 placeholder-gray-400 text-gray-700 shadow-sm" /><div class="absolute inset-y-0 right-0 pr-3 flex items-center"><div class="relative group/tooltip"><FontAwesomeIcon icon="info-circle" class="h-4 w-4 text-gray-400 hover:text-emerald-500 cursor-help transition-colors" /><div class="absolute bottom-full right-0 mb-2 w-80 p-3 bg-gray-900 text-white text-sm rounded-lg shadow-xl opacity-0 invisible group-hover/tooltip:opacity-100 group-hover/tooltip:visible transition-all duration-200 z-50"><div class="space-y-2"><p class="font-semibold text-emerald-300">💡 Dicas de busca:</p><div class="space-y-1 text-xs"><p>📝 <span class="text-emerald-200">Nome:</span>Digite parte do nome</p><p>📱 <span class="text-emerald-200">CPF:</span>123.456.789-00 ou 12345678900</p><p>🆔 <span class="text-emerald-200">ID:</span>Digite o número do ID</p><p>🏥 <span class="text-emerald-200">SimplesVet:</span>Digite o código</p></div></div><div class="absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div></div></div></div></div><div class="flex items-center gap-3 flex-wrap"><div class="flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-emerald-100 to-green-100 rounded-full"><FontAwesomeIcon icon="users" class="text-emerald-600 text-sm" /><span class="text-sm font-medium text-emerald-700">{{ clientesFiltrados.length}} encontrados</span></div><div class="flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-full"><FontAwesomeIcon icon="dog" class="text-blue-600 text-sm" /><span class="text-sm font-medium text-blue-700">{{ totalAnimais}} pets</span></div><div v-if="filtroBusca" class="flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-yellow-100 to-amber-100 rounded-full"><FontAwesomeIcon icon="search" class="text-amber-600 text-sm animate-pulse" /><span class="text-sm font-medium text-amber-700">Buscando: "{{ filtroBusca}}" </span></div></div></div></div></BaseCard><div class="space-y-4"><div v-for="(cliente, index) in clientesFiltrados" :key="cliente.id" class="group relative bg-gradient-to-r from-white via-white to-emerald-50 rounded-xl shadow-lg hover:shadow-2xl cursor-pointer transform transition-all duration-300 hover:-translate-y-1 animate-fade-in-up overflow-hidden" :style="{ animationDelay: `${index * 100}ms`}" @click="verDetalhes(cliente)" ><div class="p-6"><div class="flex items-center justify-between"><div class="flex items-center gap-4 flex-1"><div class="relative"><div class="w-16 h-16 bg-gradient-to-br from-emerald-400 to-green-600 rounded-2xl flex items-center justify-center shadow-lg transform group-hover:scale-110 transition-all duration-300"><FontAwesomeIcon icon="user" class="text-2xl text-white" /></div><div class="absolute -top-1 -right-1 w-6 h-6 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center shadow-md"><span class="text-xs font-bold text-white">{{ cliente.animais.length}}</span></div></div><div class="flex-1 min-w-0"><div class="flex items-center gap-3 mb-1"><h3 class="text-xl font-bold text-gray-900 truncate group-hover:text-emerald-700 transition-colors duration-300">{{ cliente.nomeCompleto}} </h3><BaseBadge :variant="cliente.animais.length >0 ? 'success' : 'gray'" size="sm" class="flex-shrink-0" >{{ cliente.animais.length}} pets </BaseBadge></div><div class="flex items-center gap-4 text-sm text-gray-600 mb-2"><span class="flex items-center gap-1"><FontAwesomeIcon icon="id-card" class="text-gray-400" />{{ formatarCpf(cliente.cpf)}} </span><span class="flex items-center gap-1"><FontAwesomeIcon icon="code" class="text-gray-400" />{{ cliente.codigoSimplesVet}} </span></div><div class="flex items-center gap-6 text-sm"><div v-if="cliente.telefones.length >0" class="flex items-center gap-2"><div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"><FontAwesomeIcon icon="phone" class="text-blue-600 text-xs" /></div><span class="text-gray-700">{{ formatarTelefone(cliente.telefones[0]?.telefone || '')}} <span v-if="cliente.telefones.length >1" class="text-gray-400">(+{{ cliente.telefones.length - 1}}) </span></span></div><div v-if="cliente.emailClientes.length >0" class="flex items-center gap-2"><div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center"><FontAwesomeIcon icon="envelope" class="text-purple-600 text-xs" /></div><span class="text-gray-700 truncate max-w-[200px]">{{ cliente.emailClientes[0]?.email || ''}} </span></div></div></div></div><div class="flex-shrink-0 ml-4"><div v-if="cliente.animais.length >0" class="text-right"><p class="text-xs text-gray-500 mb-2 font-medium">Pets cadastrados:</p><div class="flex flex-wrap gap-1 justify-end max-w-[280px]"><BaseBadge v-for="animal in cliente.animais.slice(0, 4)" :key="animal.id" variant="info" size="sm" class="transform hover:scale-105 transition-transform duration-200" >{{ animal.nome}} </BaseBadge><BaseBadge v-if="cliente.animais.length >4" variant="gray" size="sm" >+{{ cliente.animais.length - 4}} </BaseBadge></div></div><div v-else class="text-center"><p class="text-sm text-gray-400 italic">Nenhum pet cadastrado</p></div></div><div class="flex-shrink-0 ml-4"><div class="w-10 h-10 bg-gray-100 group-hover:bg-emerald-100 rounded-full flex items-center justify-center transition-all duration-300"><FontAwesomeIcon icon="chevron-right" class="text-gray-400 group-hover:text-emerald-600 group-hover:translate-x-1 transition-all duration-300" /></div></div></div></div><div class="absolute inset-0 border-2 border-transparent group-hover:border-emerald-200 rounded-xl transition-all duration-300 pointer-events-none"></div></div></div><BaseCard class="mt-8 bg-gradient-to-r from-gray-50 to-emerald-50 border-0 shadow-sm"><div class="p-4"><div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 text-sm"><div class="flex flex-wrap items-center gap-4"><div class="flex items-center gap-2"><div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div><span class="text-gray-600 font-medium"><span class="text-emerald-600 font-bold">{{ clientes.length}}</span>clientes total </span></div><div class="flex items-center gap-2"><div class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div><span class="text-gray-600 font-medium"><span class="text-blue-600 font-bold">{{ totalAnimais}}</span>pets cadastrados </span></div></div><div v-if="ultimaAtualizacao" class="flex items-center gap-2 text-gray-500"><FontAwesomeIcon icon="clock" class="text-xs" /><span>Atualizado às{{ ultimaAtualizacao}}</span></div></div></div></BaseCard></div></div><ClienteProfileModal :is-open="modalPerfilAberto" :cliente-id="clienteSelecionadoId" @close="fecharModalPerfil" @cliente-excluido="onClienteExcluido" @cliente-atualizado="onClienteAtualizado" /></div></template><script setup lang="ts">// 📚 Imports necessáriosimport{ ref, computed, onMounted} from 'vue'import{ useRouter} from 'vue-router'import BaseCard from '@/components/UI/BaseCard.vue'import BaseButton from '@/components/UI/BaseButton.vue'import BaseBadge from '@/components/UI/BaseBadge.vue'import{ clientesService} from '@/services/api'import type{ Cliente} from '@/types/api'import ClienteProfileModal from '@/components/UI/ClienteProfileModal.vue'import{ formatarCpf, formatarTelefone, formatarHorario} from '@/utils/formatters'// 🎯 Configuração do routerconst router=useRouter()// 📊 Estados reativos da aplicaçãoconst clientes=ref<Cliente[]>([]) // Lista de clientesconst loading=ref(false) // Estado de carregamentoconst error=ref<string | null>(null) // Mensagem de erroconst filtroBusca=ref('') // Filtro de busca geralconst ultimaAtualizacao=ref('') // Timestamp da última atualização// 🎭 Modal de perfilconst modalPerfilAberto=ref(false)const clienteSelecionadoId=ref<number | null>(null)// 💻 Computadas (dados derivados)const clientesFiltrados=computed(()=>{ if (!filtroBusca.value) return clientes.value const termoBusca=filtroBusca.value.toLowerCase().trim() return clientes.value.filter(cliente=>{ // 📝 Busca por nome (case-insensitive) const nomeMatch=cliente.nomeCompleto.toLowerCase().includes(termoBusca) // 📱 Busca por CPF (com e sem formatação) const cpfLimpo=cliente.cpf.replace(/\D/g, '') // Remove formatação const cpfFormatado=formatarCpf(cliente.cpf) const cpfMatch=cpfLimpo.includes(termoBusca.replace(/\D/g, '')) || cpfFormatado.toLowerCase().includes(termoBusca) // 🆔 Busca por ID do sistema (número) const idMatch=cliente.id.toString().includes(termoBusca) || cliente.codigoClienteSistema.toString().includes(termoBusca) // 🏥 Busca por código SimplesVet (número) const simplesVetMatch=cliente.codigoSimplesVet.toString().includes(termoBusca) return nomeMatch || cpfMatch || idMatch || simplesVetMatch})})const totalAnimais=computed(()=>{ return clientes.value.reduce((total, cliente)=>total + cliente.animais.length, 0)})// 🔧 Funções utilitárias movidas para @/utils/formatters// 🚀 Função principal para carregar clientesconst carregarClientes=async (): Promise<void>=>{ try{ console.log('🔄 Iniciando carregamento de clientes...') // Ativa o estado de loading loading.value=true error.value=null // 🌐 Chama a API const response=await clientesService.buscarTodos() // ✅ Sucesso - atualiza os dados clientes.value=response ultimaAtualizacao.value=formatarHorario() console.log(`✅ ${response.length} clientes carregados com sucesso!`)} catch (err){ // ❌ Erro - mostra mensagem para o usuário console.error('❌ Erro ao carregar clientes:', err) error.value=err instanceof Error ? err.message : 'Ocorreu um erro inesperado ao carregar os clientes'} finally{ // 🏁 Sempre desativa o loading loading.value=false}}// 👀 Função para ver detalhes do clienteconst verDetalhes=(cliente: Cliente): void=>{ console.log('👁️ Ver detalhes:', cliente.nomeCompleto) clienteSelecionadoId.value=cliente.id modalPerfilAberto.value=true}const fecharModalPerfil=(): void=>{ modalPerfilAberto.value=false clienteSelecionadoId.value=null}const onClienteExcluido=(clienteId: number): void=>{ // Remove o cliente da lista local clientes.value=clientes.value.filter(c=>c.id !==clienteId) console.log(`✅ Cliente ID ${clienteId} removido da lista`)}const onClienteAtualizado=(clienteAtualizado: Cliente): void=>{ // Atualiza o cliente na lista local const index=clientes.value.findIndex(c=>c.id===clienteAtualizado.id) if (index !==-1){ clientes.value[index]=clienteAtualizado console.log(`✅ Cliente ID ${clienteAtualizado.id} atualizado na lista`)}}// 🎬 Lifecycle - carrega dados quando o componente é montadoonMounted(()=>{ console.log('🎬 Componente ClientesView montado!') carregarClientes()})</script>